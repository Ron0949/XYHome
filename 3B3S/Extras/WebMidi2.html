<html>
<h3>MIDI Output Test</h3>

<script src="webmidi.min.js"></script>
<script src="webmidi.js"></script>
<script>
  var chosenPort = 0;
  var chan = 3;
  var midi;
  var outputs;
  var midiout;
  var values;
  var portname;

  WebMidi.enable(function (err) {

    if (err) {
      console.log("WebMidi could not be enabled.", err);
    } else {
      console.log("WebMidi enabled!");
      testOutputs();
    }

  });

  outputs = WebMidi.outputs

  function testOutputs() {
    console.log('Testing MIDI-Out ports...');
    //if (outputs.length == 0)
    outputs.forEach(function (port) {
      console.log('id:', port.id, 'manufacturer:', port.manufacturer, 'name:', port.name, 'version:', port.version);
      document.getElementById("midiOutSel").value = port.name;
      var mosel = document.getElementById("midiOutSel");
      midiOutSel.innerHTML += "<option value=\"" + port.id + "\">" + port.name + "</option>";
    });
  }

  /*    if (outputs.length == 0){
        midiOutSel.innerHTML += "<option value=\"" + port.id + "\">" + "No MIDI device found" + "</option>";
      }*/

  function playMIDINote() {
    var output = WebMidi.outputs[chosenPort];
    console.log(output);
    //output.playNote("C3", chan);
    if (data[3] = 144) {
      console.log(data[4]);
      console.log(data[5]);
      output.playNote("C3", chan, { velocity: (data[5] / 128) });
      output.send((144 + chan), [60, 127]);
    }
  }

  function playMIDIController() {
    var output = WebMidi.outputs[chosenPort];
    console.log(output);
    if (data[0] = 176) {
      //output.sendControlChange(53,56,chan, {time: "+3"})
      console.log(data[1]);
      console.log(data[2]);
      //output.sendControlChange(data[1], data[2], chan)
      output.send((176 + chan), [60, 40]);
    }
  }

  function updateText(selection) {
    var id = selection + 'Text';
    document.getElementById(id).value = document.getElementById(selection).value;
    chosenPort = 1
    chosenPort = (document.getElementById(selection).value);
    console.log(chosenPort);
  }

  function selChan() {
    chan = document.getElementById("channel").value;
  }
</script>


<script>
    var query = window.location.search;
    // Skip the leading ?, which should always be there, 
    // but be careful anyway
    if (query.substring(0, 1) == '?') {
      query = query.substring(1);
    }
    var data = query.split(',');
    for (i = 0; (i < data.length); i++) {
      data[i] = unescape(data[i]);
    }

</script>
<h1>The array contains this:</h1>
<ul>
  <script>
    for (i = 0; (i < data.length); i++) {
      document.write("<li>" + data[i] + "</li>\n");
    }

  </script>
</ul>


<body>
  <form id="example" name="example">

    <select id="midiOutSel" class="form-control input" onchange="updateText('midiOutSel')">
    </select>

    <br>
    <br />
    <input type="text" value="" id="midiOutSelText" />
    <br>
    <br>
    <button type="button" onclick="playMIDIController()">Play MIDI Controller</button>
    <br>
    <br>
    <button type="button" onclick="playMIDINote()">Play MIDI Note</button>
    <br>
    <h5>MIDI Channel</h5>
    <input type="text" id="channel" value="1" onchange="selChan('channel')">
    <br>
    <h5>MIDI Output</h5>
    <input type="text" id="mOut" value="1">

  </form>
</body>

</html>